<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/styles.css">
    <title>Document</title>
    <script defer>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full'); // Toggle visibility
        }

    </script>
</head>

<body class="bg-white">
    <!-- Sidebar button -->
    <button type="button" onclick="toggleSidebar()"
        class="inline-flex items-center p-2 mt-2 ms-3 text-sm text-slate-50 rounded-lg bg-indigo-700 sm:hidden hover:bg-indigo-600">
        <svg class="w-6 h-6" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path clip-rule="evenodd" fill-rule="evenodd" d="M4 6H20M4 12H20M4 18H20" fill="currentColor"></path>
        </svg>
    </button>
    
    <!-- Sidebar -->
    <aside id="sidebar"
        class="fixed top-0 left-0 w-56 h-screen transition-transform -translate-x-full sm:translate-x-0">
        <!-- close button -->
        <button type="button" onclick="toggleSidebar()"
            class="inline-flex items-center text-sm text-slate-400 bg-transparent sm:hidden hover:text-slate-300 absolute top-4 right-4">
            <svg class="w-8 h-8" stroke="currentColor" viewBox="0 0 24 24">
                <path clip-rule="evenodd" fill-rule="evenodd" d="M16 16L12 12M12 12L8 8M12 12L16 8M12 12L8 16"
                    fill="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>

        <div class="h-full px-3 py-12 overflow-y-auto bg-slate-50 shadow-md flex flex-col">
            <ul class="space-y-2 font-medium">
                <li>
                    <a href="/books/all" class="flex items-center p-2 text-indigo-900 hover:bg-slate-100 rounded-md">
                        <svg class="w-7 h-7 text-indigo-600 transition duration-75 group-hover:text-indigo-800"
                            viewBox="0 0 20 21" fill="currentColor">
                            <path stroke-width="1.5" stroke-linecap="round"
                                d="M0 2H3.58579C4.49129 2 5.35971 2.35971 6 3C6.64029 3.64029 7 4.50871 7 5.41421V11H9V5.41421C9 4.50871 9.35971 3.64029 10 3C10.6403 2.35971 11.5087 2 12.4142 2H16V13H11L9 15H7L5 13H0V2Z">
                            </path>
                        </svg>
                        <span class="ms-1">My Bookshelf</span>
                    </a>
                </li>
                <li>
                    <a href="/books/add" class="flex items-center p-2 text-indigo-900 hover:bg-slate-100 rounded-md">
                        <svg class="w-7 h-7 text-indigo-600 transition duration-75 group-hover:text-indigo-800"
                            viewBox="4 2 20 20">
                            <path d="M6 12H12M12 12H18M12 12V18M12 12V6" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round"></path>
                        </svg>
                        <span class="ms-1">Create Book</span>
                    </a>
                </li>
                <li>
                    <a href="/books/advanced-search"
                        class="flex items-center p-2 text-indigo-900 hover:bg-slate-100 rounded-md">
                        <svg class="w-7 h-7 text-indigo-600 transition duration-75 group-hover:text-indigo-800"
                            viewBox="3 1 20 24" fill="transparent">
                            <path
                                d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                        </svg>
                        <span class="flex-1 ms-1 whitespace-nowrap">Advanced Search</span>
                    </a>
                </li>

                <li>
                    <a href="/charts" class="flex items-center p-2 text-indigo-900 hover:bg-slate-100 rounded-md">
                        <svg class="w-7 h-7 text-indigo-600 transition duration-75 group-hover:text-indigo-800"
                            viewBox="0 0 20 20" fill="transparent">
                            <path
                                d="M7 0.0618896V9H15.9381C15.446 12.9463 12.0796 16 8 16C3.58172 16 0 12.4183 0 8C0 3.92038 3.05369 0.553988 7 0.0618896Z"
                                fill="currentColor" />
                            <path d="M9 0.0618897V7H15.9381C15.4869 3.38128 12.6187 0.513137 9 0.0618897Z"
                                fill="currentColor" />
                        </svg>
                        <span class="ms-1">Charts</span>
                    </a>
                </li>
            </ul>

            <div class="flex-grow"></div>

            <ul class="pt-4 mt-4 font-medium border-t border-slate-200">
                <li>
                    <a href="/logout" class="flex items-center p-2 text-indigo-900 hover:bg-slate-100 rounded-md">
                        <svg class="w-7 h-7 text-indigo-600 transition duration-75 group-hover:text-indigo-800"
                            viewBox="0 0 24 24" fill="transparent" stroke="currentColor">
                            <path d="M21 12L13 12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M18 15L20.913 12.087V12.087C20.961 12.039 20.961 11.961 20.913 11.913V11.913L18 9"
                                stroke-width="2" stroke-linecap="round" />
                            <path
                                d="M16 5V4.5V4.5C16 3.67157 15.3284 3 14.5 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H14.5C15.3284 21 16 20.3284 16 19.5V19.5V19"
                                stroke-width="2" stroke-linecap="round" />

                        </svg>
                        <span class="ms-1">Logout</span>
                    </a>
                </li>
                <!-- TODO: Add REST API -->
                <li>
                    <a href="/" class="flex items-center p-2 text-indigo-900 hover:bg-slate-100 rounded-md">
                        <svg class="w-7 h-7 text-indigo-600 transition duration-75 group-hover:text-indigo-800"
                            viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M20,6H4A2,2,0,0,0,2,8v8a2,2,0,0,0,2,2H20a2,2,0,0,0,2-2V8A2,2,0,0,0,20,6ZM9.29,14.8,9,13.73H7.16L6.87,14.8H5.17L7,9.07H9.09L11,14.8Zm6.34-3.14a1.7,1.7,0,0,1-.36.64,1.82,1.82,0,0,1-.67.44,2.75,2.75,0,0,1-1,.17h-.44V14.8H11.6V9.09h2a2.43,2.43,0,0,1,1.62.47,1.67,1.67,0,0,1,.55,1.35A2.36,2.36,0,0,1,15.63,11.66Zm2.58,3.14H16.66V9.09h1.55ZM8.45,11.53l.24.93H7.48l.24-.93c0-.13.08-.28.12-.47s.09-.38.13-.57a4.63,4.63,0,0,0,.1-.48c0,.13.07.29.11.5l.15.58Zm5.59-1a.57.57,0,0,1,.16.43.75.75,0,0,1-.11.42.59.59,0,0,1-.27.22.9.9,0,0,1-.37.07h-.31V10.34h.4A.63.63,0,0,1,14,10.51Z"
                                fill-rule="evenodd" />

                        </svg>
                        <span class="ms-1">API Documentation</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside>

    <!-- Search bar -->
    <div class="p-4 sm:ml-64 m-2">
        <form class="flex items-center max-w-xl mx-auto" method="post" action="/books/search">
            <div class="w-full">
                <input type="text" name="q" id="q" th:value="${q}" placeholder="Add new book?"
                    class="bg-slate-50 border border-slate-200 text-slate-900 rounded-lg block w-full ps-5 p-2.5 focus:outline-indigo-500 focus:outline-2">
            </div>
            <button type="submit"
                class="p-2.5 ms-2 text-sm font-medium text-white bg-indigo-700 rounded-lg hover:bg-indigo-600">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"></path>
                </svg>
            </button>
        </form>
        <p class="text-sm font-light text-slate-500 mt-1 flex items-center max-w-xl mx-auto">
            Not finding your book? <a href="/books/advanced-search"
                class="font-medium text-indigo-700 hover:text-indigo-600">Advanced search</a>
        </p>
    </div>

    <div class="p-4 pt-0 sm:ml-64 m-2 gap-3 justify-items-start transition">
        <div th:each="q, stat : ${searchResult}" class="flex flex-row w-full pl-2 p-5 border-b border-slate-200 z-0">
            <img th:src="@{${q.imageLink}}" class="object-cover flex-shrink-0 w-40 h-56 rounded-lg ">
            <div class="flex flex-col p-4">
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-slate-900 " th:text="${q.title}"></h5>
                <p th:text="${q.authors}" class="text-slate-700 text-sm text-left"></p>
                
                <div class="mt-10 mb-2 flex-row inline-flex">
                    <!-- Hidden form -->
                    <form th:id="|form-${stat.count}|" action="/books/add" method="post">
                        <input type="hidden" name="title" th:value="${q.title}">
                        <input type="hidden" name="id" th:value="${q.id}">
                        <input type="hidden" name="authors" th:value="${q.authors}">
                        <input type="hidden" name="genres" th:value="${q.genres}">
                        <input type="hidden" name="imageLink" th:value="${q.imageLink}">
                        <input type="date" name="start" th:value="${q.start}" hidden>
                        <input type="date" name="end" th:value="${q.end}" hidden>
                        <input type="hidden" class="status" name="status" value="To Read">
                        <button type="submit"
                            class="inline-block border-e px-3 py-1 text-sm border bg-indigo-700 font-medium rounded-s-lg text-slate-100 hover:bg-indigo-600">To
                            Read</button>
                    </form>
                    <button th:attr="onclick=|toggleDropdownMenu('dp-menu-${stat.count}')|"
                        class="dp-btn inline-block px-2 py-1 text-sm font-medium rounded-e-lg border border-l-0 text-slate-100 hover:bg-indigo-600 bg-indigo-700">
                        <svg class="w-3 h-3" viewBox="0 0 24 24" stroke="currentColor" fill="currentColor">
                            <path
                                d="M5.70711 9.71069C5.31658 10.1012 5.31658 10.7344 5.70711 11.1249L10.5993 16.0123C11.3805 16.7927 12.6463 16.7924 13.4271 16.0117L18.3174 11.1213C18.708 10.7308 18.708 10.0976 18.3174 9.70708C17.9269 9.31655 17.2937 9.31655 16.9032 9.70708L12.7176 13.8927C12.3271 14.2833 11.6939 14.2832 11.3034 13.8927L7.12132 9.71069C6.7308 9.32016 6.09763 9.32016 5.70711 9.71069Z">
                            </path>
                        </svg>
                    </button>
                </div>

                <!-- dropdown menu -->
                <div th:id="|dp-menu-${stat.count}|" class="hidden dp-menu rounded-lg shadow w-40 border border-slate-50">
                    <ul class="text-gray-700 py-2 text-sm w-full items-start" 200>
                        <li>
                            <button class="dp-btn px-3 py-1 hover:bg-slate-100 w-full text-left"
                                th:attr="onclick=|submitFormWithStatus('To Read','form-${stat.count}')|">To
                                Read</button>
                        </li>
                        <li>
                            <button class="dp-btn px-3 py-1 hover:bg-slate-100 w-full text-left"
                                th:attr="onclick=|submitFormWithStatus('Reading','form-${stat.count}')|">Reading</button>
                        </li>
                        <li>
                            <button class="dp-btn px-3 py-1 hover:bg-slate-100 w-full text-left"
                                th:attr="onclick=|submitFormWithStatus('Read','form-${stat.count}')|">Read</button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function submitFormWithStatus(status, formId) {
            const form = document.getElementById(formId);
            const statusElement = form.querySelector(".status");
            statusElement.value = status;
            form.submit();
        }

        function toggleDropdownMenu(dpMenuId) {
            const menu= document.getElementById(dpMenuId)
            menu.classList.toggle("hidden");
        }

        document.documentElement.addEventListener("click", function (event) {
            if (!event.target.closest('.dp-btn') && !event.target.closest('.dp-menu')) {
                document.querySelectorAll('.dp-menu').forEach(menu => menu.classList.add('hidden'))
            }
        })
    </script>
</body>

</html>